zabbix_export:
  version: '6.0'
  date: '2024-01-31T07:20:46Z'
  groups:
    - uuid: b9390195ecad4986968746a2a9b56354
      name: 'My Templates'
  templates:
    - uuid: 160344450f9e4017b0d8f40d46ba3fe6
      template: 'Template Windows RDS Gateway'
      name: 'Template Windows RDS Gateway'
      description: |
        Template tooling version used: 1.00
                
        https://github.com/NikonovAleksei/zabbix/
                
        https://t.me/ad_zabbix_templates
      groups:
        - name: 'My Templates'
      items:
        - uuid: 4b33a7026fe54d7880f852b81815237f
          name: 'The user did not meet connection authorization policy requirements'
          type: ZABBIX_ACTIVE
          key: 'eventlog[Microsoft-Windows-TerminalServices-Gateway/Operational,,"Error",,^201$]'
          delay: 300s
          trends: '0'
          value_type: LOG
          request_method: POST
          tags:
            - tag: Application
              value: 'RDG Events'
          triggers:
            - uuid: 1e6eb0811820497daaee3854fe426ab1
              expression: 'logeventid(/Template Windows RDS Gateway/eventlog[Microsoft-Windows-TerminalServices-Gateway/Operational,,"Error",,^201$],,"201")=1 and nodata(/Template Windows RDS Gateway/eventlog[Microsoft-Windows-TerminalServices-Gateway/Operational,,"Error",,^201$],60s)=0'
              name: 'The user ( {{ITEM.VALUE}.iregsub("(\w.+[: {$DOMAIN}].*)","\1")}), on "{HOST.NAME}", RDS didn''t allow connection'
              priority: WARNING
        - uuid: 11ad220b7c5a4662b20f5486e7684bc8
          name: 'RDG Port'
          key: 'net.tcp.listen[{$RDS.GW.PORT}]'
          type: ZABBIX_ACTIVE
          delay: 300s
          tags:
            - tag: Application
              value: RDG
          triggers:
            - uuid: 9ec33bef017149ecb7a3a69a5e9fa3f3
              expression: 'last(/Template Windows RDS Gateway/net.tcp.listen[{$RDS.GW.PORT}],#1:now-0)=0'
              name: 'RDG Port is down on {HOST.NAME}'
              priority: HIGH
        - uuid: caa18599054f42b884003ff8d6e932e3
          name: 'State of service "IAS" (Network Policy Server)'
          key: 'service_state[IAS]'
          type: ZABBIX_ACTIVE
          history: 1d
          description: 'To resolve this issue, ensure that the Network Policy Server service is started.'
          tags:
            - tag: Application
              value: Services
          triggers:
            - uuid: 4659079a54ff43988bf409e4700c2eb4
              expression: 'min(/Template Windows RDS Gateway/service_state[IAS],#3)<>0'
              name: 'Service "IAS" (Network Policy Server) is not running'
              priority: HIGH
        - uuid: d203279b2f7249aca399e249450823d9
          name: 'State of service "RPCHTTPLBS" (RPC/HTTP Load Balancing Service)'
          key: 'service_state[RPCHTTPLBS]'
          type: ZABBIX_ACTIVE
          history: 1d
          tags:
            - tag: Application
              value: Services
          triggers:
            - uuid: 92391fe1e8f24351a358857a5c91fb22
              expression: 'min(/Template Windows RDS Gateway/service_state[RPCHTTPLBS],#3)<>0'
              name: 'Service "RPCHTTPLBS" (RPC/HTTP Load Balancing Service) is not running'
              priority: HIGH
        - uuid: bd80a3612bd9436ea07018b1a4806276
          name: 'State of service "TSGateway" (Remote Desktop Gateway)'
          key: 'service_state[TSGateway]'
          type: ZABBIX_ACTIVE
          history: 1d
          description: 'To resolve this issue, restart the Remote Desktop Gateway service. Restarting the Remote Desktop Gateway service also restarts all dependent services.'
          tags:
            - tag: Application
              value: Services
          triggers:
            - uuid: a351c05a77044ddaaf8bd78ab984150f
              expression: 'min(/Template Windows RDS Gateway/service_state[TSGateway],#3)<>0'
              name: 'Service "TSGateway" (Remote Desktop Gateway) is not running'
              priority: HIGH

        - uuid: e8eff81eb85d4a0f9accd1becfc7af5a
          name: 'RDG Current connections'
          key: 'perf_counter_en[\Terminal Service Gateway\Current connections]'
          type: ZABBIX_ACTIVE
          history: 1w
          description: 'Current connections to RDG (both active and disconnected)'
          tags:
            - tag: Application
              value: RDG

        - uuid: 8753541fddb246c5800cc0f6b5af07d9
          name: 'RDG Total connections'
          key: 'perf_counter_en[\Terminal Service Gateway\Successful connections]'
          type: ZABBIX_ACTIVE
          history: 1w
          description: 'Total cumulative connections to RDG'
          tags:
            - tag: Application
              value: RDG

        - uuid: cc9d5e93ec8b4111bdc759fd2afb454e
          name: 'RDG Connection Authorization Time'
          key: 'perf_counter_en[\Terminal Service Gateway\Connection request authorization time]'
          type: ZABBIX_ACTIVE
          history: 1w
          description: 'Time from connection request to authorization'
          tags:
            - tag: Application
              value: RDG

        - uuid: c680caa1e14f405cb6aedbb120d69ef3
          name: 'RDG Failed Connection Authorization'
          key: 'perf_counter_en[\Terminal Service Gateway\Failed Connection Authorization]'
          type: ZABBIX_ACTIVE
          history: 1w
          description: 'Failed Connection Authorization Attempts'
          tags:
            - tag: Application
              value: RDG

        - uuid: 02e4d570d21d42839672cf4981793744
          name: 'RDG Failed Resource Authorization'
          key: 'perf_counter_en[\Terminal Service Gateway\Failed Resource Authorization]'
          type: ZABBIX_ACTIVE
          history: 1w
          description: 'Failed Resource Authorization Attempts'
          tags:
            - tag: Application
              value: RDG

        - uuid: b59a3b3c8610433a8ed3bbfc3eac26d9
          name: 'RDG Failed connections'
          key: 'perf_counter_en[\Terminal Service Gateway\Failed connections]'
          type: ZABBIX_ACTIVE
          history: 1w
          description: 'Failed Connection Attempts'
          tags:
            - tag: Application
              value: RDG              

      macros:
        - macro: '{$RDS.GW.PORT}'
          value: '443'

  graphs:

    - uuid: 2fe7d1ebd0024030988932c99f3e8c14
      name: 'RDG Current Connections'
      ymin_type_1: FIXED
      graph_items:
        - color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Template Windows RDS Gateway'
            key: 'perf_counter_en[\Terminal Service Gateway\Current connections]'

    - uuid: 439a1f4d00c14c4886359d701136e4a1
      name: 'RDG Total Connections'
      ymin_type_1: FIXED
      graph_items:
        - color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Template Windows RDS Gateway'
            key: 'perf_counter_en[\Terminal Service Gateway\Successful connections]' 

    - uuid: 2fa45c9c1f7e45449b08a77cfbfafdf3
      name: 'RDG Authorization Time'
      ymin_type_1: FIXED
      graph_items:
        - color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Template Windows RDS Gateway'
            key: 'perf_counter_en[\Terminal Service Gateway\Connection request authorization time]'

    - uuid: 5648ad6de6eb489791cc8c8d5c93e1f7
      name: 'RD Gateway Failed Connections'
      ymin_type_1: FIXED
      graph_items:
        - color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Template Windows RDS Gateway'
            key: 'perf_counter_en[\Terminal Service Gateway\Failed Connection Authorization]'
        - sortorder: '1'
          color: F63100
          calc_fnc: ALL
          item:
            host: 'Template Windows RDS Gateway'
            key: 'perf_counter_en[\Terminal Service Gateway\Failed Resource Authorization]'
        - sortorder: '2'
          color: 2774A4
          calc_fnc: ALL
          item:
            host: 'Template Windows RDS Gateway'
            key: 'perf_counter_en[\Terminal Service Gateway\Failed connections]'
